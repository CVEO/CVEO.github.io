---
interface Props {
  years: number[];
  selectedYear?: number;
  className?: string;
  id?: string;
}

const { 
  years,
  selectedYear,
  className = '',
  id = ''
} = Astro.props;

---

<div class={`time-axis ${className}`} id={id}>
  <!-- 桌面端：垂直时间轴 -->
  <div class="hidden md:flex flex-col items-start space-y-4">
    {years.map(year => (
      <button
        type="button"
        class={`flex items-center group transition-all duration-200 ${
          selectedYear === year 
            ? 'text-brand-900 font-semibold' 
            : 'text-slate-600 hover:text-slate-900'
        }`}
        data-year={year}
        data-onclick="timeAxisYearClick"
      >
        <div class={`flex-shrink-0 w-3 h-3 rounded-full mr-3 transition-all duration-200 ${
          selectedYear === year 
            ? 'bg-brand-600 scale-125' 
            : 'bg-slate-300 group-hover:bg-slate-400'
        }`}></div>
        <span class="text-lg">{year}</span>
        {selectedYear === year && (
          <div class="ml-2 w-16 h-0.5 bg-brand-600"></div>
        )}
      </button>
    ))}
  </div>

  <!-- 移动端：水平滚动时间轴 -->
  <div class="md:hidden overflow-x-auto pb-2 -mx-2 px-2">
    <div class="flex space-x-4 min-w-max">
      {years.map(year => (
        <button
          type="button"
          class={`flex-shrink-0 px-4 py-2 rounded-lg transition-all duration-200 whitespace-nowrap ${
            selectedYear === year 
              ? 'bg-brand-600 text-white shadow-sm' 
              : 'bg-slate-100 text-slate-700 hover:bg-slate-200'
          }`}
        data-year={year}
        data-onclick="timeAxisYearClick"
        >
          {year}
        </button>
      ))}
    </div>
  </div>

  <!-- 全部按钮 -->
  <div class="mt-6 md:mt-8">
    <button
      type="button"
      class={`text-sm transition-all duration-200 ${
        !selectedYear 
          ? 'text-brand-900 font-semibold' 
          : 'text-slate-600 hover:text-slate-900'
      }`}
        data-year="0"
        data-onclick="timeAxisYearClick"
    >
      {!selectedYear ? '✓ 显示全部' : '显示全部'}
    </button>
  </div>
</div>

<style>
  .time-axis {
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 #f1f5f9;
  }
  
  .time-axis::-webkit-scrollbar {
    height: 6px;
  }
  
  .time-axis::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 3px;
  }
  
  .time-axis::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
  }
  
  .time-axis::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }
</style>

<script>
  // 时间轴点击事件处理
  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    const button = target.closest('button[data-onclick="timeAxisYearClick"]');
    
    if (button) {
      const year = parseInt(button.getAttribute('data-year') || '0');
      
      // 触发自定义事件
      const event = new CustomEvent('timeaxis-year-select', {
        detail: { year },
        bubbles: true
      });
      button.dispatchEvent(event);
    }
  });
</script>